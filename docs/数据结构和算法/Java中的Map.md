## ğŸ§  ç¬¬ä¸€éƒ¨åˆ†ï¼š`HashMap`ï¼ˆJava 8+ï¼‰

### 1. è´Ÿè½½å› å­ & æ‰©å®¹è§¦å‘æ¡ä»¶

æ ¹æ®å®˜æ–¹ Javadoc è¯´æ˜ï¼š

> å½“ å“ˆå¸Œè¡¨ä¸­æ¡ç›®æ•° è¶…è¿‡ `loadFactor Ã— å½“å‰å®¹é‡` æ—¶ï¼Œå“ˆå¸Œè¡¨å°† **é‡æ–°å“ˆå¸Œï¼ˆrehashï¼‰**ï¼Œå³æ‰©å®¹ä¸ºçº¦ä¸¤å€å®¹é‡çš„æ¡¶æ•°ç»„â€¯[rommansabbir.com+4dev.to+4github.com+4](https://dev.to/codegreen/explain-internal-working-of-hashmap-in-java-4ifm?utm_source=chatgpt.com)[medium.com+15docs.oracle.com+15dev.to+15](https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html?utm_source=chatgpt.com)ã€‚

- é»˜è®¤ `initial capacity = 16`ï¼Œ`loadFactor = 0.75`
- åˆå§‹é˜ˆå€¼ `threshold = 16 Ã— 0.75 = 12`
- æ’å…¥ç¬¬ 13 ä¸ªå…ƒç´ æ—¶è§¦å‘ `resize()`ï¼Œå®¹é‡å˜ä¸º 32ï¼Œ`threshold` æ›´æ–°ä¸º `32 Ã— 0.75 = 24`ï¼ˆå®é™…ä¸Šæºç å°† threshold å€¼ç¿»å€ï¼‰â€¯[digitalocean.com+3docs.oracle.com+3baeldung.com+3](https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html?utm_source=chatgpt.com)[baeldung.com+1dev.to+1](https://www.baeldung.com/java-hashmap-load-factor?utm_source=chatgpt.com)ã€‚

### 2. æ‰©å®¹å†…éƒ¨æœºåˆ¶

æºç ä¸­ `resize()` ä¼šï¼š

1. åˆ›å»ºæ–°æ¡¶æ•°ç»„ï¼Œå®¹é‡é€šå¸¸ä¸ºåŸå®¹é‡ * 2ã€‚

2. é‡æ–°åˆ†é…æ‰€æœ‰å·²æœ‰æ¡ç›®ï¼Œéå†æ—§æ•°ç»„ï¼Œ**é€æ¡¶ rehash å’Œè¿ç§»**ï¼Œè¿™æ˜¯ä¸€ä¸ª O(n) æ“ä½œâ€¯[dev.to+1bugs.openjdk.org+1](https://dev.to/abhishek_kumar_d9009a7ae6/internal-working-of-hashmap-2n28?utm_source=chatgpt.com)[github.com+7docs.oracle.com+7dev.to+7](https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html?utm_source=chatgpt.com)ã€‚

   1. æ›´æ–° `threshold = newCapacity Ã— loadFactor`ï¼ˆæˆ–ç›´æ¥ `oldThreshold * 2`ï¼‰â€¯

   [stackoverflow.com](https://stackoverflow.com/questions/50512758/hashmap-threshold-and-loadfactor-capacity?utm_source=chatgpt.com)

### 3. é“¾è¡¨ â†” çº¢é»‘æ ‘ è½¬æ¢æœºåˆ¶

å‚è€ƒ JDK 8 æºç æ³¨é‡Šï¼ˆ`TREEIFY_THRESHOLD = 8`, `MIN_TREEIFY_CAPACITY = 64`ï¼‰â€¯[github.com+3github.com+3studytonight.com+3](https://github.com/AdoptOpenJDK/openjdk-jdk8u/blob/master/jdk/src/share/classes/java/util/HashMap.java?utm_source=chatgpt.com)ï¼š

- æŸä¸ªæ¡¶ä¸­çš„é“¾è¡¨èŠ‚ç‚¹ â‰¥â€¯8 ä¸”å½“å‰è¡¨å®¹é‡ â‰¥â€¯64 æ—¶ï¼Œå°†å…¶ **è½¬æˆçº¢é»‘æ ‘ï¼ˆTreeNodeï¼‰**ï¼Œä»¥å°†æœ€åæŸ¥æ‰¾æ—¶é—´ç”± O(n) é™ä¸º O(log n)ã€‚
- å¦‚æœå®¹é‡ä¸è¶³ï¼ˆ<64ï¼‰ï¼Œåˆ™ä¼˜å…ˆ **æ‰©å®¹**ï¼Œä¸æ ‘åŒ–ã€‚
- æ ‘åŒ–åçš„é“¾è¡¨é•¿åº¦é™è‡³ â‰¤â€¯6 æ—¶ï¼Œä¼šé€€å›æˆé“¾è¡¨ã€‚

------

## ğŸ”„ ç¬¬äºŒéƒ¨åˆ†ï¼š`ConcurrentHashMap`ï¼ˆJava 8+ï¼‰

### 1. è´Ÿè½½å› å­ & æ‰©å®¹åˆ¤æ–­

ä» OpenJDK æºç æ³¨é‡Šï¼š

> æ„é€ å‡½æ•°æ ¹æ® `loadFactor` å’Œåˆå§‹æ¡ç›®æ•°è®¾ç½®æ¡¶æ•°ç»„åˆå§‹å¤§å°ï¼›å½“**å¹³å‡æ¯ä¸ªæ¡¶çš„å…ƒç´ æ•°**è¶…è¿‡ `loadFactor` æ—¶ï¼Œä¼šè§¦å‘æ‰©å®¹â€¯[dev.to+1github.com+1](https://dev.to/abhishek_kumar_d9009a7ae6/internal-working-of-hashmap-2n28?utm_source=chatgpt.com)[stackoverflow.com+8android.googlesource.com+8dev.to+8](https://android.googlesource.com/platform/libcore/%2B/fe39951/luni/src/main/java/java/util/concurrent/ConcurrentHashMap.java?utm_source=chatgpt.com)ã€‚

é»˜è®¤å€¼ï¼š

- `initialCapacity = 16`
- `loadFactor = 0.75`
- å¸¦å¹¶å‘æ°´å¹³ hintï¼Œä½†ä¸å½±å“æ‰©å®¹ç­–ç•¥â€¯[baeldung.com+2android.googlesource.com+2dev.to+2](https://android.googlesource.com/platform/libcore/%2B/fe39951/luni/src/main/java/java/util/concurrent/ConcurrentHashMap.java?utm_source=chatgpt.com)ã€‚

### 2. æ‰©å®¹è§¦å‘æ—¶æœº & å¹¶å‘å¤„ç†

å®é™…æ‰©å®¹æ˜¯ç”± `sizeCtl` å˜é‡æ§åˆ¶ï¼Œé¦–æ¬¡æ’å…¥è¶…è¿‡ `threshold` ä¼šè®¾å®š `sizeCtl = - (resizeStamp << RESIZE_STAMP_SHIFT) + 2`ï¼Œå¹¶å¯åŠ¨ `transfer()` æ‰©å®¹æµç¨‹â€¯[bugs.openjdk.org](https://bugs.openjdk.org/browse/JDK-8214427https%3A/stackoverflow.com/questions/53493706/how-the-conditions-sc-rs-1-sc-rs-max-resizers-can-be-achieved-in?utm_source=chatgpt.com)ã€‚

ä¸ `HashMap` ä¸åŒï¼Œ`ConcurrentHashMap` çš„æ‰©å®¹è¿‡ç¨‹æ˜¯ï¼š

- **å¹¶å‘çš„**ï¼šå¤šçº¿ç¨‹å¯ä»¥é€šè¿‡ CAS åä½œå®Œæˆæ¡¶çš„æ¬è¿ï¼Œæ— éœ€å…¨è¡¨é”â€¯[baeldung.com+15github.com+15android.googlesource.com+15](https://github.com/frohoff/jdk8u-jdk/blob/master/src/share/classes/java/util/concurrent/ConcurrentHashMap.java?utm_source=chatgpt.com)[javaconceptoftheday.com+1docs.oracle.com+1](https://javaconceptoftheday.com/how-concurrenthashmap-works-internally-after-java-8/?utm_source=chatgpt.com)ã€‚
- **éç¬æ—¶å®Œæˆ**ï¼šæ‰©å®¹ä¸æ¡¶æ¬è¿æ˜¯åˆ†æ­¥è¿›è¡Œçš„ï¼Œå› æ­¤å¯èƒ½å¤šæ­¥å®Œæˆï¼Œæ„Ÿè§‰â€œæ²¡é‚£ä¹ˆå¿«â€ã€‚
- ä½¿ç”¨ `sizeCtl`è®°å½•åŒæ—¶æ¬è¿çº¿ç¨‹æ•°ï¼Œé¿å…è¿‡åº¦å¹¶å‘â€¯[bugs.openjdk.org+1stackoverflow.com+1](https://bugs.openjdk.org/browse/JDK-8214427https%3A/stackoverflow.com/questions/53493706/how-the-conditions-sc-rs-1-sc-rs-max-resizers-can-be-achieved-in?utm_source=chatgpt.com)ã€‚

------

## âœ… é‡ç‚¹å¯¹æ¯”æ€»ç»“

| ç‰¹æ€§                 | `HashMap`                          | `ConcurrentHashMap`                               |
| -------------------- | ---------------------------------- | ------------------------------------------------- |
| é»˜è®¤è´Ÿè½½å› å­         | 0.75                               | 0.75                                              |
| æ‰©å®¹è§¦å‘æ¡ä»¶         | `size > threshold = capacity Ã— lf` | `avg bucket entries > lf`ï¼Œå³ `size/buckets > lf` |
| æ‰©å®¹è§¦å‘åŠ¨ä½œ         | å•çº¿ç¨‹ resizeï¼ŒO(n)                | å¤šçº¿ç¨‹ CAS åä½œè¿ç§»æ¡¶ï¼Œåˆ†æ­¥è¿ç§»ï¼Œæ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°   |
| å•æ¡¶é“¾è¡¨è½¬çº¢é»‘æ ‘æœºåˆ¶ | â‰¥8 ä¸”å®¹é‡ â‰¥64 æ—¶æ ‘åŒ–               | **ä¸æ”¯æŒæ ‘åŒ–**ï¼Œå§‹ç»ˆé“¾è¡¨â€¯ï¼ˆæºç æ—  TREEIFYï¼‰       |
| æ ‘åŒ–åè½¬é“¾è¡¨         | â‰¤6 æ—¶é€€å›é“¾è¡¨                      | æ— æ­¤æœºåˆ¶                                          |



## âœ… å›ç­”ä½ æå‡ºçš„é—®é¢˜

1. **æ‰©å®¹è§¦å‘åˆ°åº•å–å†³äºä»€ä¹ˆï¼Ÿ**
   - `HashMap`ï¼šå…ƒç´ æ•°è¶…è¿‡ `capacity Ã— loadFactor` æ—¶è§¦å‘ï¼›
   - `ConcurrentHashMap`ï¼šå¹³å‡æ¯æ¡¶å…ƒç´ æ•°è¶…è¿‡ loadFactor æ—¶è§¦å‘ã€‚
2. **é•¿é“¾ä½†å®¹é‡å°æ˜¯å¦ O(n)ï¼Ÿ**
   - æ˜¯çš„ã€‚å¦‚æœé“¾æ¡é•¿ä½†è¡¨å®¹é‡ <64ï¼Œ`HashMap` ä¼šä¼˜å…ˆæ‰©å®¹ï¼Œè€Œéæ ‘åŒ–ã€‚è‹¥å®¹é‡å·²è¶³ï¼Œä¸”é“¾æ¡ â‰¥8ï¼Œæ‰åšæ ‘åŒ–ï¼ŒæŸ¥æ‰¾å¤æ‚åº¦å˜ä¸º O(log n)ã€‚
3. **HashMap çš„æ‰©å®¹å’Œé“¾è¡¨è½¬æ ‘æ¡ä»¶**ï¼š
   - æ‰©å®¹è§¦å‘åŒè´Ÿè½½å› å­ï¼›
   - é“¾è¡¨è½¬æ ‘éœ€æ»¡è¶³é“¾é•¿ â‰¥8 ä¸”å®¹é‡ â‰¥64ï¼ˆæºç  `TREEIFY_THRESHOLD`, `MIN_TREEIFY_CAPACITY`ï¼‰â€¯[docs.oracle.com](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentHashMap.html?utm_source=chatgpt.com)[studytonight.com+1dev.to+1](https://www.studytonight.com/post/hashmap-performance-improvements-in-java-8-using-treeify-threshold?utm_source=chatgpt.com)ã€‚



# Mapä¸­å¸¸è§çš„ä¸‰ç§å®ç°

## ğŸ¥‡ 1. `HashMap`

### ğŸ“¦ åº•å±‚ç»“æ„ï¼ˆJDK 8 èµ·ï¼‰ï¼š

```java
Node<K, V>[] table;  // å“ˆå¸Œæ¡¶æ•°ç»„ï¼Œæ¯ä¸ª bucket æ˜¯é“¾è¡¨/æ ‘çš„å¤´èŠ‚ç‚¹
```

- å“ˆå¸Œæ¡¶æ•°æ˜¯ 2 çš„å¹‚ï¼ˆä¾¿äºç”¨ä½è¿ç®—ä¼˜åŒ– hash â†’ indexï¼‰
- æ¯ä¸ªæ¡¶æœ€åˆæ˜¯é“¾è¡¨ï¼Œé“¾è¡¨é•¿åº¦ â‰¥ 8 ä¸”æ€»å®¹é‡ â‰¥ 64 æ—¶è½¬ä¸ºçº¢é»‘æ ‘ï¼ˆæé«˜æŸ¥æ‰¾æ•ˆç‡ï¼‰
- æ¯æ¬¡æ’å…¥ key éƒ½ä¼š `hash(key) & (table.length - 1)` å†³å®šè½åœ¨å“ªä¸ªæ¡¶

### âš™ï¸ æ ¸å¿ƒæ“ä½œå®ç°ï¼š

| æ“ä½œ        | å®ç°æœºåˆ¶                                                     |
| ----------- | ------------------------------------------------------------ |
| `put(k,v)`  | å…ˆè®¡ç®— hashï¼Œæ‰¾åˆ°æ¡¶ã€‚è‹¥ key å·²å­˜åœ¨åˆ™è¦†ç›–ï¼Œå¦åˆ™å°¾æ’ã€‚é“¾è¡¨é•¿äº†è½¬æ ‘ã€‚ |
| `get(k)`    | æ ¹æ® hash æ‰¾æ¡¶ï¼Œå†éå†é“¾/æ ‘èŠ‚ç‚¹ `equals` æ‰¾åˆ°å€¼              |
| `remove(k)` | ç±»ä¼¼ `get` è¿‡ç¨‹ï¼Œæ‰¾åˆ°èŠ‚ç‚¹å¹¶ä»æ¡¶ä¸­ç§»é™¤                        |

### ğŸ§  è®¾è®¡ç›®çš„ï¼š

> æä¾› **O(1) å¹³å‡æŸ¥æ‰¾æ’å…¥æ•ˆç‡** çš„é€šç”¨ Map å®¹å™¨ã€‚

### ğŸ¯ åº”ç”¨åœºæ™¯ï¼š

- æŸ¥è¯¢é¢‘ç¹ã€æ— éœ€æ’åºçš„é€šç”¨é”®å€¼æ˜ å°„ï¼Œå¦‚ç¼“å­˜ã€å‚æ•°æ˜ å°„ã€ç”¨æˆ·å±æ€§è¡¨ç­‰ã€‚
- å¿«é€ŸæŸ¥æ‰¾ï¼Œä¸å…³æ³¨æ’å…¥é¡ºåºã€‚

## ğŸ¥ˆ 2. `LinkedHashMap`

### ğŸ“¦ åº•å±‚ç»“æ„ï¼š

ç»§æ‰¿è‡ª `HashMap`ï¼Œé¢å¤–ç»´æŠ¤äº†åŒå‘é“¾è¡¨

```java
Entry<K, V> before, after;  // ç»´æŠ¤æ’å…¥é¡ºåºçš„æŒ‡é’ˆ
```

- æ¯ä¸ªèŠ‚ç‚¹ä¸ä»…æ˜¯æ¡¶å†…çš„å…ƒç´ ï¼Œä¹Ÿåœ¨ä¸€ä¸ªæ•´ä½“åŒå‘é“¾è¡¨ä¸­ç»´æŠ¤å…¨å±€é¡ºåº
- æ”¯æŒæŒ‰æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºï¼ˆaccessOrder=trueï¼‰è¿›è¡Œè¿­ä»£

### âš™ï¸ æ ¸å¿ƒæ“ä½œå®ç°ï¼ˆé™¤äº†ç»§æ‰¿ `HashMap` æ“ä½œï¼‰ï¼š

| æ“ä½œ                  | å¢å¼ºæœºåˆ¶                                     |
| --------------------- | -------------------------------------------- |
| `put(k,v)`            | æ­£å¸¸ put åï¼Œå°†èŠ‚ç‚¹æŒ‚åˆ°åŒå‘é“¾è¡¨æœ«å°¾          |
| `get(k)`              | å¦‚æœå¼€å¯ accessOrderï¼Œget ä¼šå°†èŠ‚ç‚¹â€œæåˆ°é“¾å°¾â€ |
| `removeEldestEntry()` | å¯é‡å†™æ­¤æ–¹æ³•å®ç° LRU ç¼“å­˜æ·˜æ±°æœºåˆ¶            |

### ğŸ§  è®¾è®¡ç›®çš„ï¼š

> åœ¨ä¿è¯ HashMap å¿«é€Ÿè®¿é—®æ€§èƒ½çš„åŸºç¡€ä¸Šï¼Œ**å¢åŠ â€œé¡ºåºâ€å¯æ§æ€§**ï¼ˆæ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºï¼‰

### ğŸ¯ åº”ç”¨åœºæ™¯ï¼š

- éœ€è¦è®°ä½æ’å…¥é¡ºåºçš„æ•°æ®ç»“æ„ï¼šæ¯”å¦‚éå†è¦æŒ‰æ’å…¥é¡ºåº
- **å®ç° LRU ç¼“å­˜çš„æ ¸å¿ƒå®¹å™¨ç»“æ„**
- Session ç®¡ç†ã€æœ€è¿‘è®¿é—®è®°å½•ç­‰

## ğŸ¥‰ 3. `TreeMap`

### ğŸ“¦ åº•å±‚ç»“æ„ï¼š

åŸºäºçº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼‰å®ç°ï¼š

```java
Entry<K,V> root;  // çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹
```

- æ‰€æœ‰ key è‡ªåŠ¨æŒ‰å¤§å°æ’åºï¼Œæ’åºæ–¹å¼æ¥è‡ªï¼š
  - key è‡ªèº«å®ç°äº† `Comparable` æ¥å£ï¼ˆé»˜è®¤ï¼‰
  - æˆ–ä¼ å…¥ä¸€ä¸ªè‡ªå®šä¹‰ `Comparator` æ„é€  `TreeMap`

### âš™ï¸ æ ¸å¿ƒæ“ä½œå®ç°ï¼š

| æ“ä½œ            | å®ç°æœºåˆ¶                          |
| --------------- | --------------------------------- |
| `put(k,v)`      | æŒ‰ key æ’åºæ’å…¥ï¼Œç»´æŠ¤çº¢é»‘æ ‘å¹³è¡¡   |
| `get(k)`        | ä»æ ¹èŠ‚ç‚¹äºŒåˆ†æŸ¥æ‰¾ï¼Œå¤æ‚åº¦ O(log n) |
| `subMap(k1,k2)` | èŒƒå›´æŸ¥æ‰¾ï¼Œåˆ©ç”¨æ ‘çš„åŒºé—´ç‰¹æ€§        |

### ğŸ§  è®¾è®¡ç›®çš„ï¼š

> å®ç°ä¸€ç§å¯ä»¥**è‡ªåŠ¨æ’åºçš„ Map**ï¼Œæä¾›åŒºé—´æŸ¥è¯¢ã€æ’åºéå†ç­‰èƒ½åŠ›ã€‚

### ğŸ¯ åº”ç”¨åœºæ™¯ï¼š

- éœ€è¦å¯¹ key åšæœ‰åºå¤„ç†ï¼ˆå¦‚æ—¶é—´çº¿ã€ç­‰çº§ã€æ•°å€¼åŒºé—´ï¼‰
- æ’è¡Œæ¦œã€æ—¶é—´çª—å£èšåˆã€åŒºé—´åŒ¹é…ç­‰å…¸å‹ä¸šåŠ¡åœºæ™¯
- éœ€è¦ `floorKey` / `ceilingKey` / `subMap` è¿™ç±»èŒƒå›´æœç´¢æ“ä½œ

## ğŸ“Œ ä¸‰è€…å¯¹æ¯”æ€»ç»“ï¼ˆé€ŸæŸ¥è¡¨ï¼‰

| ç‰¹æ€§              | `HashMap`          | `LinkedHashMap`      | `TreeMap`               |
| ----------------- | ------------------ | -------------------- | ----------------------- |
| åº•å±‚ç»“æ„          | æ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘ | HashMap + åŒå‘é“¾è¡¨   | çº¢é»‘æ ‘                  |
| key æ˜¯å¦æ’åº      | âŒ æ— é¡ºåº           | âœ… æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåº | âœ… è‡ªç„¶é¡ºåº / è‡ªå®šä¹‰æ’åº |
| æŸ¥æ‰¾/æ’å…¥å¤æ‚åº¦   | å¹³å‡ O(1)          | å¹³å‡ O(1)            | O(log n)                |
| éå†é¡ºåºæ˜¯å¦å›ºå®š  | âŒ æ— åº             | âœ… ä¿åº               | âœ… æœ‰åºï¼ˆå‡åºï¼‰          |
| æ˜¯å¦å…è®¸ null key | âœ… å…è®¸ 1 ä¸ª        | âœ… å…è®¸ 1 ä¸ª          | âŒ ä¸å…è®¸ null key       |



# TreeMapæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

## âœ… ä¸€ã€TreeMap çš„åº•å±‚æ˜¯çº¢é»‘æ ‘æ²¡é”™ï¼Œä½†æ¯ä¸ªèŠ‚ç‚¹å­˜çš„æ˜¯é”®å€¼å¯¹ï¼ˆEntryï¼‰

ä½ çœ‹åˆ°çš„æ˜¯ï¼š

```java
Entry<K, V> root;  // TreeMap çš„çº¢é»‘æ ‘æ ¹èŠ‚ç‚¹
```

ä½ ç–‘æƒ‘çš„æ˜¯ï¼šEntryï¼Ÿè¿™ä¸æ˜¯ key å’Œ value å—ï¼Ÿæ˜¯çš„ï¼

æ¥çœ‹ TreeMap æºç é‡Œçš„ Entry ç±»ç»“æ„ï¼ˆJava 8 ä¸­ï¼‰ï¼š

```java
static final class Entry<K,V> implements Map.Entry<K,V> {
    K key;
    V value;
    Entry<K,V> left;
    Entry<K,V> right;
    Entry<K,V> parent;
    boolean color = BLACK;
}
```

âœ… **çœ‹æ¸…æ¥šï¼šçº¢é»‘æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œä¸æ˜¯ä¸€ä¸ªå•çº¯çš„ keyï¼Œä¹Ÿä¸æ˜¯ valueï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„ Entry<K, V> å¯¹è±¡ã€‚**

## âœ… äºŒã€çº¢é»‘æ ‘çš„â€œæ’åºâ€åªåŸºäº keyï¼Œä¸ç®¡ value

è™½ç„¶ä½ å­˜çš„æ˜¯ `key â†’ value` æ˜ å°„ï¼Œä½†æ˜¯çº¢é»‘æ ‘æ’å…¥æ—¶åªæ ¹æ® `key` æ¥æ¯”è¾ƒé¡ºåºï¼š

```java
int cmp = compare(key, p.key);
```

æ„æ€æ˜¯ï¼š

> value æ˜¯è·Ÿéš key é™„å¸¦å­˜è¿›å»çš„ï¼Œæ ‘çš„ç»“æ„å’Œæ’åºåªå…³å¿ƒ keyã€‚

è¿™ä¹Ÿå°±å›ç­”äº†ä½ çš„æ ¹æœ¬é—®é¢˜ï¼š

> â€œæ ‘æ€ä¹ˆè¡¨ç¤º key-value çš„ï¼Ÿâ€

**å®ƒå¹¶æ²¡æœ‰å¯¹ key-value å»ºä¸€æ£µæ ‘ï¼Œè€Œæ˜¯æŠŠã€Œé”®å€¼å¯¹ã€æ•´ä½“å½“æˆæ ‘çš„èŠ‚ç‚¹ï¼Œå¹¶åªç”¨ key æ¥è¿›è¡Œæ¯”è¾ƒæ’åºã€‚**

## âœ… ä¸‰ã€ç¤ºæ„å›¾ï¼šTreeMap æ˜¯è¿™æ ·çš„ç»“æ„ï¼ˆå‡è®¾ int ç±»å‹çš„ keyï¼‰

```
        (50 â†’ "a")
       /          \
 (30 â†’ "b")     (70 â†’ "c")
    /     \          \
(10â†’"x") (40â†’"y")   (90â†’"z")
```

æŸ¥æ‰¾ `70`ï¼Œæ˜¯æŒ‰ key çš„å¤§å°è§„åˆ™ä» root ä¸€å±‚å±‚æ‰¾ä¸‹å»ï¼›value `"c"` æ˜¯å­˜å‚¨åœ¨èŠ‚ç‚¹é‡Œçš„ã€‚

## âœ… å››ã€ä½ å¯èƒ½æ··æ·†çš„â€œå•å€¼æ ‘â€ä¸â€œé”®å€¼æ ‘â€çš„åŒºåˆ«

| é”™è¯¯è®¤çŸ¥ï¼ˆä½ çœ‹åˆ°çš„ï¼‰ | æ­£ç¡®ç»“æ„ï¼ˆTreeMapï¼‰                                          |
| -------------------- | ------------------------------------------------------------ |
| æ ‘èŠ‚ç‚¹åªèƒ½æ”¾ä¸€ä¸ªå€¼   | æ ‘èŠ‚ç‚¹æ˜¯ä¸€ä¸ª Entryï¼ˆK, Vï¼‰å¯¹è±¡                               |
| æ ‘åªèƒ½åš Set ç”¨      | TreeMap = æœ‰åºçš„ Mapï¼Œæ ‘ç”¨äºæ’åº keyï¼Œvalue è·Ÿç€å­˜           |
| çº¢é»‘æ ‘ = æ ‘ç»“æ„      | çº¢é»‘æ ‘ = æ’å…¥æœ‰é¢œè‰²è§„åˆ™çš„â€œèŠ‚ç‚¹å¯¹è±¡é›†åˆâ€ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥æ˜¯ä»»æ„ç»“æ„ |

## âœ… äº”ã€ä½ å¯ä»¥è¿™æ ·ç±»æ¯”è®°å¿†ï¼š

- `HashMap` æ˜¯ç”¨æ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘ï¼Œæ ¹æ® **key çš„ hash** æ¥åˆ†æ¡¶ï¼ˆæ— åºï¼‰
- `TreeMap` æ˜¯ç›´æ¥ç”¨ **çº¢é»‘æ ‘** æ¥åš key çš„æ’åºæŸ¥æ‰¾ï¼Œ**æ•´ä¸ªç»“æ„å°±æ˜¯ä¸€æ£µæ’åºæ ‘**ï¼Œvalue æ˜¯å‰¯äº§å“ï¼ŒæŒ‚åœ¨æ ‘èŠ‚ç‚¹ä¸Šçš„

## âœ… è¡¥å……ä¸€å¥å…³äº key æ¯”è¾ƒï¼š

TreeMap çš„ key æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š

- key å®ç°äº† `Comparable` æ¥å£ï¼ˆæ¯”å¦‚ Integerã€Stringï¼‰ã€‚
- æˆ–ä½ æ„é€  `TreeMap` æ—¶ä¼ å…¥ `Comparator<K>`ã€‚

å¦åˆ™ä½ æ”¾è¿›å»ä¼šæŠ¥é”™ `ClassCastException`

## âœ… æ€»ç»“ä½ ç°åœ¨è¦è®°ä½çš„æ ¸å¿ƒç‚¹ï¼š

1. `TreeMap` çš„çº¢é»‘æ ‘ä¸æ˜¯å­˜ key ä¹Ÿä¸æ˜¯å­˜ valueï¼Œè€Œæ˜¯**æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ª Entry<K, V>**
2. çº¢é»‘æ ‘çš„ç»“æ„ç”¨äº**æ’åº key**ï¼Œä¸æ˜¯ç”¨æ¥ç»„ç»‡ value çš„
3. value æ˜¯ â€œæŒ‚åœ¨èŠ‚ç‚¹ä¸Šâ€ çš„ï¼Œå’Œæ ‘çš„é€»è¾‘ç»“æ„æ— å…³ï¼Œåªæ˜¯ Map çš„åŠŸèƒ½éœ€æ±‚





# æ€ç»´å‡çº§ï¼šMap â‰  HashMap

## âœ… æ ¸å¿ƒè§‚ç‚¹ï¼š

> **å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰å’Œæ ‘ï¼ˆTreeï¼‰éƒ½æ˜¯åº•å±‚æ•°æ®ç»“æ„**ï¼Œå®ƒä»¬å¯ä»¥è¢«ç”¨æ¥**å®ç°æŠ½è±¡æ•°æ®ç»“æ„ Mapï¼ˆé”®å€¼å¯¹æ˜ å°„ï¼‰**ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼š

| æŠ½è±¡ç»“æ„              | å…·ä½“å®ç°                                 |
| --------------------- | ---------------------------------------- |
| `Map<K, V>`ï¼ˆé”®å€¼å¯¹ï¼‰ | å¯ä»¥ç”±å“ˆå¸Œè¡¨ã€çº¢é»‘æ ‘ã€è·³è¡¨ç­‰å¤šç§æ–¹å¼å®ç° |

## ğŸ§  æ¢å¥è¯è¯´ï¼š

- **`Map` æ˜¯æ¥å£ï¼ˆæŠ½è±¡ï¼‰**
  - ä½ åªå…³å¿ƒï¼šèƒ½ `put(k, v)`ï¼Œèƒ½ `get(k)`ï¼Œèƒ½ `remove(k)`ï¼Œèƒ½ `éå†`
  - è‡³äºå®ƒæ€ä¹ˆåšåˆ°è¿™äº›ï¼Œæ˜¯å®ç°ç±»çš„äº‹æƒ…
- **`HashMap` æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°çš„ Map**
  - key â†’ hash â†’ index â†’ æ•°ç»„æ¡¶ â†’ value
  - ä¼˜ç‚¹ï¼šæŸ¥æ‰¾å¿«ï¼ˆå¹³å‡ O(1)ï¼‰ï¼Œç¼ºç‚¹ï¼šæ— åºï¼Œå“ˆå¸Œå†²çªå½±å“æ€§èƒ½
- **`TreeMap` æ˜¯ç”¨çº¢é»‘æ ‘å®ç°çš„ Map**
  - key â†’ æ¯”è¾ƒ â†’ å·¦/å³åˆ†æ”¯æ’å…¥ â†’ çº¢é»‘æ ‘èŠ‚ç‚¹ï¼ˆå­˜ key-valueï¼‰
  - ä¼˜ç‚¹ï¼šæœ‰åºã€æ”¯æŒåŒºé—´æŸ¥è¯¢ï¼Œç¼ºç‚¹ï¼šæŸ¥æ‰¾æ’å…¥æ˜¯ O(log n)

## ğŸ§© ç±»æ¯”è®°å¿†ï¼ˆé¢è¯•å¸¸ç”¨ï¼‰

| Map ç±»å‹            | åº•å±‚ç»“æ„                    | ç‰¹ç‚¹ï¼ˆé‡ç‚¹ï¼‰                     |
| ------------------- | --------------------------- | -------------------------------- |
| `HashMap`           | å“ˆå¸Œè¡¨ + æ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘ | æ— åºï¼ŒæŸ¥æ‰¾å¿«ï¼Œæœ€é€šç”¨             |
| `TreeMap`           | çº¢é»‘æ ‘                      | key æœ‰åºï¼Œæ”¯æŒèŒƒå›´æŸ¥æ‰¾ã€æ’åºéå† |
| `LinkedHashMap`     | HashMap + åŒå‘é“¾è¡¨          | ä¿ç•™æ’å…¥é¡ºåºï¼Œå¯å®ç° LRU ç¼“å­˜    |
| `ConcurrentHashMap` | åˆ†æ®µå“ˆå¸Œè¡¨ / CAS            | å¹¶å‘å®‰å…¨ï¼ŒHashMap çš„å¹¶å‘å¢å¼ºç‰ˆ   |

## ğŸ§ª æ€ç»´å‡çº§ï¼šMap â‰  HashMap

å¾ˆå¤šåˆå­¦è€…æœ‰ä¸ªè¯¯åŒºï¼š

> â€œMap å°±æ˜¯ HashMap å§ï¼Ÿâ€

å…¶å®è¿™å°±åƒè¯´ï¼š

> â€œList å°±æ˜¯ ArrayList å§ï¼Ÿâ€

å½“ç„¶ä¸æ˜¯ï¼

- `List` å¯ä»¥æ˜¯ `ArrayList`ï¼ˆé¡ºåºæ•°ç»„ï¼‰
- ä¹Ÿå¯ä»¥æ˜¯ `LinkedList`ï¼ˆåŒå‘é“¾è¡¨ï¼‰

åŒç†ï¼š

- `Map` å¯ä»¥æ˜¯ `HashMap`ï¼ˆå“ˆå¸Œè¡¨ï¼‰
- ä¹Ÿå¯ä»¥æ˜¯ `TreeMap`ï¼ˆçº¢é»‘æ ‘ï¼‰
- ä¹Ÿå¯ä»¥æ˜¯ `ConcurrentHashMap`ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰

------

## âœ… ç»“è®ºï¼ˆä½ è¯´å¾—å¯¹ï¼‰ï¼š

âœ”ï¸ å“ˆå¸Œè¡¨å’Œçº¢é»‘æ ‘éƒ½æ˜¯å®ç° Map çš„â€œå…·ä½“æ•°æ®ç»“æ„â€
 âœ”ï¸ `Map` æ˜¯åŠŸèƒ½å±‚çš„æŠ½è±¡æ¥å£
 âœ”ï¸ ä¸åŒå®ç°ç±»æœ‰ä¸åŒçš„æ€§èƒ½ç‰¹æ€§å’Œä½¿ç”¨åœºæ™¯ â€”â€” ä¼šé€‰æ‰æ˜¯é«˜æ‰‹











